<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8" />
    <title>Acord GDPR - Campania "Pe Gard" | ZIRA MARKETING S.R.L.</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2em;
            background: #f0f4f8;
            color: #333;
        }
        .container {
            max-width: 720px;
            margin: auto;
            background: #fff;
            padding: 2em 2.5em;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
        }
        h2 {
            color: #004d80;
            margin-bottom: 0.2em;
            text-align: center;
            font-weight: 700;
            letter-spacing: 1px;
        }
        #document-id {
            font-size: 0.9rem;
            color: #555;
            text-align: center;
            margin-bottom: 1.5em;
            font-style: italic;
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 12px;
            margin-bottom: 2em;
            font-size: 1rem;
        }
        th, td {
            text-align: left;
            padding: 12px 16px;
        }
        th {
            background-color: #e1ebf7;
            font-weight: 600;
            color: #004d80;
            border-radius: 8px 8px 0 0;
        }
        tbody tr {
            background-color: #f9fbfd;
            border-radius: 8px;
            box-shadow: inset 0 -1px 0 #d1dce8;
        }
        tbody tr:last-child {
            box-shadow: none;
        }
        tbody td {
            border-left: 5px solid transparent;
            transition: border-color 0.3s ease;
        }
        tbody tr:hover td {
            border-left-color: #004d80;
            background-color: #e6f0fa;
        }
        section p {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 1.2em;
            padding: 0 8px;
        }
        @media print {
            body, .container {
                margin: 0;
                padding: 1cm;
                width: 100%;
                box-shadow: none;
                background: white;
                color: black;
                font-size: 12pt;
                line-height: 1.2;
                page-break-after: avoid;
                page-break-inside: avoid;
            }
            h2, h3 {
                page-break-after: avoid;
                page-break-inside: avoid;
                margin-top: 0.5em;
                margin-bottom: 0.3em;
            }
            table {
                width: 100%;
                border-spacing: 0 8px;
                font-size: 12pt;
            }
            th, td {
                padding: 6px 8px;
                border: 1px solid #444;
            }
            tbody tr {
                box-shadow: none;
                background: white !important;
                border: 1px solid #444;
            }
            .actions {
                display: none; /* ascunde butonul de email la print */
            }
            p {
                margin: 0.5em 0;
                line-height: 1.2;
            }
            #document-id {
                font-style: normal;
                font-size: 10pt;
                color: black;
                text-align: left;
                margin-bottom: 1em;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h2>Acord GDPR - Campania "Pe Gard"</h2>
    <div id="document-id"></div>

    <section>
        <h3>Informații generale despre operator</h3>
        <table aria-label="Date operator ZIRA MARKETING S.R.L.">
            <tbody>
            <tr>
                <th>Denumire</th>
                <td>ZIRA MARKETING S.R.L.</td>
            </tr>
            <tr>
                <th>CUI</th>
                <td>46154679</td>
            </tr>
            <tr>
                <th>Reg. Comerțului</th>
                <td>J31/386/2022</td>
            </tr>
            <tr>
                <th>Adresă completă</th>
                <td>Sat Zimbor, Comuna Zimbor, Nr. 215, Cod poștal 457370</td>
            </tr>
            </tbody>
        </table>
    </section>

    <section>
        <h3>Datele personale colectate</h3>
        <table aria-label="Date personale participant la campanie">
            <tbody>
            <tr>
                <th>Nume complet</th>
                <td id="gdpr-name"></td>
            </tr>
            <tr>
                <th>Telefon</th>
                <td id="gdpr-phone"></td>
            </tr>
            <tr>
                <th>Email</th>
                <td id="gdpr-email"></td>
            </tr>
            <tr>
                <th>Consimțământ GDPR</th>
                <td id="gdpr-consent"></td>
            </tr>
            <tr>
                <th>Dată consimțământ</th>
                <td id="gdpr-timestamp"></td>
            </tr>
            </tbody>
        </table>
    </section>

    <section>
        <h3>Acord GDPR pentru campania "Pe Gard"</h3>
        <p>
            Subsemnatul <span id="gdpr-name-2"></span>, declar că am luat cunoștință și sunt de acord ca datele mele personale (nume, telefon, email), să fie prelucrate de către SC ZIRA MARKETING S.R.L., în scopul participării la campania "Pe Gard".<br>
            Prelucrarea se va realiza conform prevederilor Regulamentului (UE) 2016/679 privind protecția datelor cu caracter personal (GDPR).<br>
            Datele mele nu vor fi transmise către terți fără acordul explicit și vor fi păstrate doar pe durata necesară desfășurării campaniei.<br>
            Consimțământul a fost acordat la data de <span id="gdpr-timestamp-2"></span>, putând fi retras oricând prin notificare la operatorul de date.
        </p>
    </section>

    <div class="actions" style="text-align:center;">
        <a id="emailLink" class="button" href="#" target="_blank" style="
            background: #007acc; 
            color: white; 
            padding: 12px 24px; 
            border-radius: 8px; 
            font-weight: 600; 
            text-decoration: none;
            display: inline-block;
            margin-top: 1.5em;
            box-shadow: 0 4px 10px rgb(0 122 204 / 0.25);
            transition: background-color 0.25s ease;
        " onmouseover="this.style.background='#005f99'" onmouseout="this.style.background='#007acc'">Trimite email către participant</a>
    </div>
</div>

<script>
    function getQueryParam(param) {
        return new URLSearchParams(window.location.search).get(param);
    }

    const id = getQueryParam('id');
    if (!id) {
        alert('Parametrul "id" lipsește din URL');
        throw new Error('Parametrul "id" lipsește din URL');
    }

    // Afiseaza id-ul ca numar document/data sub titlu
    const now = new Date();
    const formattedDate = now.toLocaleDateString("ro", {day: "2-digit", month: "2-digit", year: "numeric"});
    document.getElementById("document-id").textContent = `Nr. document: ${id} / Data: ${formattedDate}`;

    fetch(`http://localhost:8081/api/zira/pegard/gdpr/?id=${encodeURIComponent(id)}`)
        .then(r => r.json())
        .then(data => {
            if (!data[0]) return;
            const info = data[0];
            document.getElementById("gdpr-name").textContent = info.fullname || "";
            document.getElementById("gdpr-phone").textContent = info.phone || "";
            document.getElementById("gdpr-email").textContent = info.email || "";
            document.getElementById("gdpr-consent").textContent = info.gdprconsent ? "Da" : "Nu";
            document.getElementById("gdpr-timestamp").textContent = info.timestamp ? new Date(info.timestamp).toLocaleString("ro") : "";
            document.getElementById("gdpr-name-2").textContent = info.fullname || "";
            document.getElementById("gdpr-timestamp-2").textContent = info.timestamp ? new Date(info.timestamp).toLocaleDateString("ro") : "";

            document.getElementById("emailLink").href = 
                "mailto:" + encodeURIComponent(info.email || "") + 
                "?subject=" + encodeURIComponent("Acord GDPR campania Pe Gard") + 
                "&body=" + encodeURIComponent("Salut, " + (info.fullname || "") + ",\n\nAcesta este acordul GDPR pentru campania Pe Gard.");
        })
        .catch(e => {
            alert('Eroare la încărcarea datelor GDPR.');
            console.error(e);
        });
</script>
</body>
</html>
