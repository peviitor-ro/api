<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8" />
    <title>Contract - ZIRA MARKETING S.R.L.</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2em auto;
            max-width: 720px;
            background: #fff;
            color: #333;
            line-height: 1.5;
        }
        h1 {
            color: #004d80;
            text-align: center;
            margin-bottom: 0.1em;
        }
        #contract-number {
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 2em;
            color: #555;
            user-select: text;
        }
        section {
            margin-bottom: 1.8em;
        }
        strong {
            color: #004d80;
        }
        .error {
            color: red;
            font-weight: bold;
            text-align: center;
            margin-top: 2em;
        }
    </style>
</head>
<body>
    <h1 id="contract-title">Contract</h1>
    <div id="contract-number"></div>

    <div id="contract-container">
        <!-- Contract va fi afișat aici -->
    </div>

    <div id="error-message" class="error" style="display:none;"></div>

    <script>
        function getQueryParam(param) {
            return new URLSearchParams(window.location.search).get(param);
        }

        function formatTimestamp(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            return date.toLocaleDateString('ro') + ' ' + date.toLocaleTimeString('ro', {hour: '2-digit', minute:'2-digit'});
        }

        const id = getQueryParam('id');
        const apiUrl = `https://api.peviitor.ro/zira/pegard/gdpr/?id=${encodeURIComponent(id)}`;
        const container = document.getElementById('contract-container');
        const errorMsg = document.getElementById('error-message');
        const contractTitle = document.getElementById('contract-title');
        const contractNumber = document.getElementById('contract-number');

        if (!id) {
            errorMsg.textContent = "Parametrul 'id' lipsește din URL.";
            errorMsg.style.display = "block";
        } else {
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error('Eroare la apelul API.');
                    return response.json();
                })
                .then(data => {
                    if (!data[0]) {
                        throw new Error('Datele nu au fost găsite pentru ID-ul dat.');
                    }
                    const user = data[0];
                    const firma = {
                        denumire: 'ZIRA MARKETING S.R.L.',
                        cui: '46154679',
                        regComertului: 'J31/386/2022',
                        adresa: 'Sat Zimbor, Comuna Zimbor, Nr. 215, Cod poștal 457370'
                    };

                    const tipContractRaw = (user.contract || '').toLowerCase();
                    const contractTipText = (tipContractRaw === 'inchiriere') ? 'Închiriere' : 'Comodat';

                    // Setăm titlul în funcție de tip contract
                    contractTitle.textContent = `Contract ${contractTipText}`;

                    // Setăm numărul contractului fix sub titlu
                    contractNumber.textContent = `Nr. contract: ${id}`;

                    const dataContract = formatTimestamp(user.timestamp);

                    container.innerHTML = `
                        <section>
                            <h3>Între</h3>
                            <p><strong>SC ${firma.denumire}</strong>, înregistrată cu CUI ${firma.cui}, Registrul Comerțului Nr. ${firma.regComertului},<br>
                            cu sediul în ${firma.adresa}, denumită în continuare <em>„Chiriaș/Comodatar”</em>,</p>
                            <p>și</p>
                            <p><strong>${user.fullname || 'Nume proprietar'}</strong>,<br>
                            telefon: ${user.phone || 'N/A'},<br>
                            email: ${user.email || 'N/A'}, denumit/denumită în continuare <em>„Proprietar”</em>.</p>
                        </section>
                        <section>
                            <h3>Obiectul contractului</h3>
                            <p>${(tipContractRaw === 'inchiriere')
                                ? 'Proprietarul închiriază și Chiriașul primește în folosință și folosește, cu plată, bunul/piesa pusă la dispoziție în cadrul campaniei „Pe Gard”.'
                                : 'Proprietarul dă în folosință, iar Comodatarul primește în folosință și folosește, fără plată, bunul/piesa pusă la dispoziție în cadrul campaniei „Pe Gard”.'}</p>
                        </section>
                        <section>
                            <h3>Durata contractului</h3>
                            <p>Durata prezentului contract este stabilită prin acordul părților sau pe durata desfășurării campaniei „Pe Gard”.</p>
                        </section>
                        <section>
                            <h3>Obligațiile părților</h3>
                            <ul>
                                <li><strong>Chiriaș/Comodatar:</strong> să asigure bunul în stare bună și să respecte regulile fiscale și legale aplicabile.</li>
                                <li><strong>Proprietar:</strong> să folosească bunul cu grijă și să-l returneze în stare bună la expirarea contractului.</li>
                            </ul>
                        </section>
                        <section>
                            <h3>Prelucrarea datelor personale</h3>
                            <p>Prin semnarea acestui contract, <strong>${user.fullname || 'Nume proprietar'}</strong> declară că a luat cunoștință și își dă consimțământul pentru prelucrarea datelor sale personale de către SC ZIRA MARKETING S.R.L., în conformitate cu Regulamentul (UE) 2016/679 (GDPR), în scopul desfășurării campaniei „Pe Gard”.</p>
                        </section>
                        <section>
                            <h3>Alte clauze</h3>
                            <p>Eventualele litigii apărute din interpretarea sau executarea prezentului contract se vor soluționa pe cale amiabilă sau, în caz contrar, de instanțele judecătorești competente.</p>
                        </section>
                        <section>
                            <p style="margin-top:3em;">Data semnării: <strong>${dataContract}</strong></p>
                            <p>Semnătura Chiriaș/Comodatar: ___________________________</p>
                            <p>Semnătura Proprietar: _____________________</p>
                        </section>
                    `;
                })
                .catch(err => {
                    errorMsg.textContent = err.message;
                    errorMsg.style.display = "block";
                });
        }
    </script>
</body>
</html>
